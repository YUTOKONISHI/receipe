<h1>レシピサイト</h1>

<div>
	<p>レシピ名から検索</p>
	<%= search_form_for @search, url: root_path  do |f| %>
	<div class="form-group">
		<%= f.text_field :title_cont, class: "form-control" %>
	</div>	
	
	<p>カテゴリから検索</p>
	<%= f.collection_radio_buttons :receipe_category_id_eq , @receipe_category, :id, :name , {:checked => false}%>
	
	<p>検索オプション</p>
    <%= params[:q] %><br>	
    <%= f.collection_check_boxes :ingredients_allergens_id_in_any, @allergens, :id, :name, {:checked => false, multiple: true } %> <%# not条件? %>

    <%# end %>
	<div class="actions"><%= f.submit "検索" %></div>
	<% end %>
</div>



<h2>検索結果</h2>
<% @results.each do |result| %>
<ul>
  <li>レシピ名: <%= result.title %></li>
  
  <li>カテゴリ: <%= category_name(result.receipe_category_id) %>
  
  </li>
  
  <li>レシピの評価: 
  	
  	<div id='average-star-rating'></div>
  	
  </li>
  
  <li>アレルギー物質: 
  		<% result.ingredients.each do |ingredient| %>
   			<% ingredient.allergens.each do |allergen| %>
           	<%= allergen.name %><br>
   			<% end %>
   		<% end %>
  </li>
  
  <li>レシピの紹介: <%= result.introduction %></li>
  
</ul>

<script>
$('#average-star-rating').raty({
path: '/assets/',
readOnly: true,
score : <%= average_rate_for_search_result(result.id) %>

});
</script>

<% end %>

<% if session[:usr] %>
<%= link_to 'マイページ', mypage_path %>
<%= link_to 'ログアウト', logout_path, method: :post %>
<% else %>
<%= link_to 'ユーザ登録', new_user_path %>
<%= link_to 'ログイン', login_index_path %>
<% end %>